# 老司机 iOS 周报 #232 | 2023-02-13

![ios-weekly](https://github.com/SwiftOldDriver/iOS-Weekly/blob/master/assets/ios-weekly.png?raw=true)
老司机 iOS 周报，只为你呈现有价值的信息。

你也可以为这个项目出一份力，如果发现有价值的信息、文章、工具等可以到 [Issues](https://github.com/SwiftOldDriver/iOS-Weekly/issues) 里提给我们，我们会尽快处理。记得写上推荐的理由哦。有建议和意见也欢迎到 [Issues](https://github.com/SwiftOldDriver/iOS-Weekly/issues) 提出。

## 新闻

### [Swift 5.7 在 iOS 16 以下的系统创建 Task 时可能会发生 Bad access](https://github.com/apple/swift/issues/63420)

Swift 团队在迭代的过程中删去了 Concurrency 相关代码的一个字段，内存布局产生变化，导致 iOS 16 以下的系统在创建 Task 时，部分情况下内存访问会出错，导致崩溃。

目前已经在主线分支完成修复，按照去年的发布节奏，可能会在三月份发布的 Xcode 里带上这个修复。遇到这个问题的同学如果着急的话，可以先回退到 Xcode 13.x 版本。

##  Developer - 设计开发加速器

> 设计开发加速器相关活动

## 新手推荐

> 收集一些对新手友好且质量不错的文章

### 🐎 [如何实现 iOS 16 带来的 Depth Effect 图片效果](https://mp.weixin.qq.com/s/9ITEbW1_EGu_2vrVfrZ9lA)

[@zoeGuo](https://github.com/zoeGuo)： iOS 16 系统为我们带来了比较惊艳的桌面锁屏效果：Depth Effect。它可以使用一张普通图片当背景，同时可以在适当的地方遮拦住部分桌面组件，形成一种景深的效果。那么我们可以在自己的 App 实现类似的效果吗？文章介绍了如何使用[苹果机器学习官网](https://developer.apple.com/machine-learning/models/)提供的机器学习模型 DeeplabV3 一步步实现 Depth Effect 效果的。虽然 DeeplabV3 模型在具体应用中还有一定的局限性，但作为尝鲜体验也是非常不错的～

## 文章

> 写的不错的技术博客，包含但不局限于 iOS、多端统一、设计、产品等

### 🐎 [Prevent copy & paste into other iOS apps](https://blog.eidinger.info/prevent-copy-paste-into-other-ios-apps)

[@Smallfly](https://github.com/iostalks)：iOS 系统的封闭性给不同 App 之间的通信增加了门槛，而剪切板是为数不多的跨应用通信方案。为了保护用户的隐私，在 iOS 14 之后应用读取剪切板需要用户的授权，但在低系统或者用户误操作的情况下，依然存在剪切板数据被窃取的可能性。

本文介绍了两种保护剪切板数据安全的方法，一种是在 App 进入后台时，清空剪切板内容；另一种是强制使用 `custom pasteboard`，具体实现方案可参阅原文。

### 🌟 🐕 [iOS APP虚拟内存用量初探](https://juejin.cn/post/7196931784328626234)

[@ChengzhiHuang](https://github.com/ChengzhiHuang)：作者先通过对不同设备测试 task_vm_info 中具体值发现了规律：

- 同一种机型 max_address 是固定的，而 min_address 和 aslr 的偏移保持一致
- 不同机型(内存容量)的 max_address 有所不同

接着通过对 XNU 代码的阅读证实了以上的结论，并进一步探讨了 ``设置虚拟内存范围时机``，``Reserved region``，``虚拟内存总大小`` 等内容。最后验证了开启 虚拟内存扩容（com.apple.developer.kernel.extended-virtual-addressing） 后虚拟内存的变化。阅读后会对虚拟内存有一个更加直观的了解。

一个应用场景就是当需要判断某一个指针是否为 malloc 出来的合法指针，除了可以用 ``malloc_zone_from_ptr`` ，还前置判断地址是否在 ``task_vm_info.min_address ~ task_vm_info.max_address`` 之间来提升效率。

### 🐢 [The evolution of Facebook’s iOS app architecture](https://engineering.fb.com/2023/02/06/ios/facebook-ios-app-architecture/)

[@含笑饮砒霜](https://weibo.com/chinafishnews/)：Facebook for iOS (FBIOS) 是 Meta 最古老的移动代码库。自 2012 年该应用程序被重写以来，它已经由数千名工程师共同开发并交付给数十亿用户，它可以支持数百名工程师同时对其进行迭代。经过多年的迭代，Facebook 代码库已经不像典型的 iOS 代码库了，本文将阐明演变背后的技术决策及其历史背景：
- 2014，建立自己的移动框架：React
- 2015，减轻和改进启动所需的更改
- 2016，动态库和模块化
- 2017，重新思考 FBIOS 架构 
- 2018，生成代码的激增
- 2020，Swift 和语言架构
- 2022，架构演变完成了1%，未来仍将继续
f
## 工具

> 开发过程中常用的工具，及一些新工具的介绍

## 代码

> 库，代码段，开源app

## 书

> 比较不错的书的推荐和书评

## 音视频

> 比较不错的书的推荐和书评

## 摸鱼周报

[@摸鱼周报 #83](https://mp.weixin.qq.com/s/Ty95hGBIevHaJQ5TU774aQ)：第 83 期摸鱼周报来了，一起来看下本期概要：

* 本期话题：各大搜索引擎开始接入类 ChatGPT 功能

* 本周学习：Python 中的匿名函数与闭包

* 内容推荐：iOS 越狱检测、获取虚拟内存状态、使用 KeyChain 进行持久化等内容

* 摸一下鱼：Stable Diffusion 功能尝鲜；关于技术规划的思考；大厂复盘文档

## 内推

重新开始更新「iOS 靠谱内推专题」，整理了最近明确在招人的岗位，供大家参考

具体信息请移步：https://www.yuque.com/iosalliance/article/bhutav 进行查看（如有招聘需求请联系 iTDriverr）

## 关注我们

我们是「老司机技术周报」，一个持续追求精品 iOS 内容的技术公众号，欢迎关注。

**关注有礼，关注【老司机技术周报】，回复「2021」，领取 2017/2018/2019/2020 内参**

![](https://github.com/SwiftOldDriver/iOS-Weekly/blob/master/assets/qrcode_for_wechat.jpg?raw=true)

同时也支持了 RSS 订阅：https://github.com/SwiftOldDriver/iOS-Weekly/releases.atom 。

## 说明

🚧 表示需某工具，🌟 表示编辑推荐

预计阅读时间：🐎 很快就能读完（1 - 10 mins）；🐕 中等 （10 - 20 mins）；🐢 慢（20+ mins）
